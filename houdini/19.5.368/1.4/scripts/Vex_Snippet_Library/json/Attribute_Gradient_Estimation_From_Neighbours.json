{
    "label": "Attribute_Gradient_Estimation_From_Neighbours",
    "context": "Points",
    "data": "// VEX neighbours & weighted averaging - Point Wrangle Example\n\n// Assign string variable for gradient attrib name.\nstring atr_name = chs(\"gradient_attrib\");\n\n// Assign variables for point gradient and position.\nfloat grad = point(0, atr_name, @ptnum);\nvector pos = @P;\n\n// Find all neighbouring point numbers as an array.\nint neighbours[] = neighbours(0, @ptnum);\n\n// Create empty arrays for neighbouring weight and direction values.\nfloat weights[]; vector dirs[];\n\n// Iterate over neighbours, finding their point gradient and positions.\nforeach(int npt; neighbours){\n    float n_grad = point(0, atr_name, npt);\n    vector n_pos = point(0, \"P\", npt);\n    \n    // Weight neighbour gradient by difference to current point and 1.\n    float weight = fit(grad, n_grad, 1, 0, 1);\n    append(weights, weight);\n    \n    // Find vector direction/magnitude and append to dir array.\n    vector n_dir = n_pos - pos;\n    append(dirs, n_dir * weight);\n}\n// Find the weighted gradient sum of all neighbouring directions.\nv@direction = sum(dirs) / sum(weights);\n"
}